<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CBSP Admin Dashboard</title>
  <style>
    :root {
      --bg: #f5f8ff;
      --text: #102037;
      --muted: #4f6280;
      --line: #d7e2ef;
      --card: #ffffff;
      --primary: #1f3a8a;
      --accent: #0f766e;
      --danger: #b91c1c;
      --forbidden: #7c3aed;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;
      color: var(--text);
      background: linear-gradient(180deg, #eef2fb, var(--bg) 46%);
    }
    .wrap {
      max-width: 1180px;
      margin: 0 auto;
      padding: 20px 16px 30px;
    }
    .hero {
      background: linear-gradient(120deg, #fff, #edf3ff 40%, #eef8f5);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 8px 20px rgba(18, 26, 45, 0.08);
    }
    .hero-top {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    h1 {
      margin: 0;
      font-size: 26px;
    }
    .sub {
      margin: 8px 0 0;
      color: var(--muted);
    }
    .chips {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .chip {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      border: 1px solid #cfe0ff;
      background: #eef5ff;
      color: #1f4d99;
    }
    .chip.ok {
      border-color: #c7eee8;
      background: #ecfaf8;
      color: #0f766e;
    }
    .chip.warn {
      border-color: #f5dfc2;
      background: #fff7ea;
      color: #9a5408;
    }
    .auth {
      margin-top: 12px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 10px;
      align-items: end;
    }
    .field label {
      display: block;
      margin-bottom: 4px;
      color: var(--muted);
      font-size: 13px;
    }
    .field input,
    .field textarea,
    .field select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: #fff;
      font-size: 14px;
    }
    .field textarea {
      min-height: 84px;
      resize: vertical;
    }
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    button {
      border: 1px solid transparent;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 13px;
      cursor: pointer;
      color: #fff;
      background: linear-gradient(90deg, var(--primary), #3150ad);
    }
    button.secondary {
      color: #1f2a40;
      background: #fff;
      border-color: var(--line);
    }
    button.danger {
      background: linear-gradient(90deg, #b91c1c, #dc2626);
    }
    button:disabled {
      opacity: 0.55;
      cursor: not-allowed;
    }
    .row {
      margin-top: 14px;
      display: grid;
      grid-template-columns: 230px 1fr;
      gap: 12px;
    }
    .nav {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 10px;
      height: fit-content;
    }
    .nav h2 {
      margin: 2px 4px 8px;
      font-size: 14px;
      color: var(--muted);
      font-weight: 600;
    }
    .nav button {
      width: 100%;
      margin-bottom: 8px;
      text-align: left;
      background: #fff;
      color: #1f2a40;
      border: 1px solid var(--line);
    }
    .nav button.active {
      border-color: #bfd4ff;
      background: #edf4ff;
      color: #123b83;
    }
    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 14px;
      margin-bottom: 10px;
    }
    .state {
      border-radius: 12px;
      padding: 12px;
      border: 1px solid #cde2ff;
      background: #eef6ff;
      color: #1f4a96;
      margin-bottom: 10px;
    }
    .state.loading {
      border-color: #cde2ff;
      background: #eef6ff;
      color: #1f4a96;
    }
    .state.empty {
      border-color: #cfe9e3;
      background: #edf9f6;
      color: #11695f;
    }
    .state.error {
      border-color: #f2cbcb;
      background: #fff3f3;
      color: #b91c1c;
    }
    .state.forbidden {
      border-color: #e2d6fb;
      background: #f6f1ff;
      color: var(--forbidden);
    }
    .state h3 {
      margin: 0 0 4px;
      font-size: 15px;
    }
    .state p {
      margin: 0;
      font-size: 13px;
      color: inherit;
      opacity: 0.95;
      white-space: pre-wrap;
    }
    .hidden {
      display: none;
    }
    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .table th, .table td {
      text-align: left;
      border-bottom: 1px solid #e4ecf4;
      padding: 8px 4px;
      vertical-align: top;
    }
    .table th {
      color: var(--muted);
      font-weight: 600;
    }
    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 12px;
    }
    .hint {
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
    }
    .danger-zone {
      border: 1px solid #efcaca;
      background: #fff5f5;
    }
    .danger-zone h3 {
      margin-top: 0;
      color: #a11c1c;
    }
    .checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #273047;
      margin: 8px 0;
    }
    .audit-list {
      margin: 0;
      padding-left: 18px;
      font-size: 13px;
    }
    .audit-list li {
      margin-bottom: 6px;
    }
    @media (max-width: 940px) {
      .row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="hero">
      <div class="hero-top">
        <div>
          <h1>Admin Dashboard</h1>
          <p class="sub">Admin guard, forbidden feedback, and destructive-action confirmation flow.</p>
        </div>
        <div class="chips">
          <span id="chip-api" class="chip">API: checking...</span>
          <span id="chip-user" class="chip warn">Session: signed out</span>
          <span id="chip-role" class="chip">Role: guest</span>
        </div>
      </div>

      <form id="login-form" class="auth">
        <div class="field">
          <label for="username">Username</label>
          <input id="username" name="username" placeholder="admin.demo or agent.demo" />
        </div>
        <div class="field">
          <label for="password">Password</label>
          <input id="password" name="password" type="password" placeholder="pass-1234" />
        </div>
        <div class="actions">
          <button id="btn-login" type="submit">Login</button>
          <button id="btn-admin" type="button" class="secondary" onclick="window.__cbspAdminQuickLogin && window.__cbspAdminQuickLogin('admin.demo','pass-1234','#/admin/channels');">Quick Admin</button>
          <button id="btn-agent" type="button" class="secondary" onclick="window.__cbspAdminQuickLogin && window.__cbspAdminQuickLogin('agent.demo','pass-1234','#/admin/channels');">Quick Agent</button>
          <button id="btn-logout" type="button" class="danger">Logout</button>
        </div>
      </form>
    </section>

    <section class="row">
      <aside class="nav">
        <h2>Admin Routes</h2>
        <button data-route="/admin/channels">/admin/channels</button>
        <button data-route="/admin/automations">/admin/automations</button>
        <button data-route="/admin/integrations">/admin/integrations</button>
        <button data-route="/admin/analytics">/admin/analytics</button>
        <button id="goto-workbench" class="secondary" type="button">Open Workbench</button>
      </aside>

      <main>
        <section class="panel">
          <div id="view-state" class="state loading">
            <h3>loading</h3>
            <p>Waiting for route data...</p>
          </div>
          <div id="view-content" class="hidden"></div>
        </section>

        <section class="panel danger-zone">
          <h3>Danger Zone: destructive rehearsal</h3>
          <p class="hint">
            Admin-only action. Requires confirmation + reason. A dry-run marker is recorded for audit evidence.
          </p>
          <div class="field">
            <label for="danger-target">Target scope</label>
            <select id="danger-target"></select>
          </div>
          <div class="field">
            <label for="danger-reason">Reason (required for audit)</label>
            <textarea id="danger-reason" placeholder="Example: stale integration removed during release rehearsal."></textarea>
          </div>
          <label class="checkbox">
            <input id="danger-confirm" type="checkbox" />
            I understand this action is destructive and traceable.
          </label>
          <div class="actions">
            <button id="danger-run" type="button" class="danger">Run Destructive Rehearsal</button>
          </div>
          <h4>Audit trail</h4>
          <ul id="audit-list" class="audit-list"></ul>
        </section>
      </main>
    </section>
  </div>

  <script src="/apps/shared/auth-client.js"></script>
  <script src="/apps/shared/api-client.js"></script>
  <script>
    window.__CBSPAdminBooted = false;
    window.__cbspAdminQuickLogin = async function fallbackAdminQuickLogin(username, password, targetHash) {
      if (window.__CBSPAdminBooted) return;
      try {
        if (!window.CBSPAuth || typeof window.CBSPAuth.login !== "function") {
          alert("Auth client not loaded yet. Refresh this page once.");
          return;
        }
        await window.CBSPAuth.login(username, password);
        if (targetHash) location.hash = targetHash;
        location.reload();
      } catch (error) {
        var message =
          window.CBSPAuth && typeof window.CBSPAuth.formatError === "function"
            ? window.CBSPAuth.formatError(error)
            : ((error && error.message) || String(error));
        alert("Quick login failed: " + message);
      }
    };

    function runAdmin(auth, api) {
      window.__CBSPAdminBooted = true;
      var stateEl = document.getElementById("view-state");
      var contentEl = document.getElementById("view-content");
      var chipApi = document.getElementById("chip-api");
      var chipUser = document.getElementById("chip-user");
      var chipRole = document.getElementById("chip-role");
      var form = document.getElementById("login-form");
      var usernameInput = document.getElementById("username");
      var passwordInput = document.getElementById("password");
      var loginBtn = document.getElementById("btn-login");
      var logoutBtn = document.getElementById("btn-logout");
      var quickAdminBtn = document.getElementById("btn-admin");
      var quickAgentBtn = document.getElementById("btn-agent");
      var gotoWorkbenchBtn = document.getElementById("goto-workbench");
      var navButtons = Array.from(document.querySelectorAll("[data-route]"));

      var dangerTarget = document.getElementById("danger-target");
      var dangerReason = document.getElementById("danger-reason");
      var dangerConfirm = document.getElementById("danger-confirm");
      var dangerRun = document.getElementById("danger-run");
      var auditList = document.getElementById("audit-list");
      var auditEntries = [];
      var integrationOptions = [];

      var routes = {
        "/admin/channels": { roles: ["admin"], loader: loadChannels },
        "/admin/automations": { roles: ["admin", "manager"], loader: loadAutomations },
        "/admin/integrations": { roles: ["admin"], loader: loadIntegrations },
        "/admin/analytics": { roles: ["admin", "manager"], loader: loadAnalytics },
      };

      function htmlEscape(input) {
        return String(input)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      function setState(type, title, detail) {
        stateEl.className = "state " + type;
        stateEl.innerHTML =
          "<h3>" + htmlEscape(type) + "</h3>" +
          "<p><strong>" + htmlEscape(title) + "</strong>\n" + htmlEscape(detail || "") + "</p>";
        contentEl.classList.add("hidden");
        contentEl.innerHTML = "";
      }

      function setContent(html) {
        contentEl.innerHTML = html;
        contentEl.classList.remove("hidden");
      }

      function getCurrentRoute() {
        var hash = location.hash || "#/admin/channels";
        var route = hash.replace(/^#/, "");
        if (!routes[route]) return "/admin/channels";
        return route;
      }

      function setRoute(route) {
        location.hash = route;
      }

      function updateActiveNav(route) {
        navButtons.forEach(function (btn) {
          btn.classList.toggle("active", btn.getAttribute("data-route") === route);
        });
      }

      function getFirstAllowedRoute() {
        if (!auth.isLoggedIn()) return null;
        var role = auth.getRole();
        if (!role) return null;
        for (var i = 0; i < navButtons.length; i += 1) {
          var route = navButtons[i].getAttribute("data-route");
          if (checkRoleAccess(route)) return route;
        }
        return null;
      }

      function syncNavAccess() {
        var role = auth.getRole();
        var loggedIn = auth.isLoggedIn();
        navButtons.forEach(function (btn) {
          var route = btn.getAttribute("data-route");
          var allowed = loggedIn && checkRoleAccess(route);
          btn.disabled = !allowed;
          if (allowed) {
            btn.title = "";
            return;
          }
          if (!loggedIn) {
            btn.title = "Login required";
            return;
          }
          btn.title = "Role '" + (role || "guest") + "' cannot access " + route;
        });
      }

      function updateSessionChips() {
        var session = auth.getSession();
        var role = auth.getRole() || "guest";
        chipRole.textContent = "Role: " + role;

        if (session && session.user && session.user.username) {
          chipUser.textContent = "Session: " + session.user.username;
          chipUser.className = "chip ok";
        } else if (session) {
          chipUser.textContent = "Session: active";
          chipUser.className = "chip ok";
        } else {
          chipUser.textContent = "Session: signed out";
          chipUser.className = "chip warn";
        }
        dangerRun.disabled = role !== "admin";
        syncNavAccess();
      }

      async function checkHealth() {
        try {
          var health = await api.health();
          chipApi.textContent = "API: " + health.status + " (" + health.dataDriver + ")";
          chipApi.className = "chip ok";
        } catch (_err) {
          chipApi.textContent = "API: offline";
          chipApi.className = "chip warn";
        }
      }

      function parseApiError(error) {
        if (api && typeof api.formatError === "function") return api.formatError(error);
        if (auth && typeof auth.formatError === "function") return auth.formatError(error);
        if (!error) return "Unknown error";
        if (error.traceId) return (error.message || "Request failed") + " (traceId=" + error.traceId + ")";
        return error.message || "Request failed";
      }

      function checkRoleAccess(route) {
        var def = routes[route];
        var role = auth.getRole();
        return Boolean(def && role && def.roles.indexOf(role) >= 0);
      }

      function renderAuditList() {
        if (!auditEntries.length) {
          auditList.innerHTML = "<li>No destructive rehearsal yet.</li>";
          return;
        }
        auditList.innerHTML = auditEntries.map(function (entry) {
          return "<li>" +
            "<span class='mono'>" + htmlEscape(entry.at) + "</span> | " +
            htmlEscape(entry.actor) + " | " +
            htmlEscape(entry.action) + " | target=" + htmlEscape(entry.target) +
            " | reason=" + htmlEscape(entry.reason) +
            "</li>";
        }).join("");
      }

      function refreshDangerTargets() {
        if (!integrationOptions.length) {
          dangerTarget.innerHTML = "<option value='none'>none</option>";
          return;
        }
        dangerTarget.innerHTML = integrationOptions.map(function (item) {
          return "<option value='" + htmlEscape(item.id) + "'>" +
            htmlEscape(item.id + " (" + (item.platform || "unknown") + ")") +
            "</option>";
        }).join("");
      }

      async function loadChannels() {
        var items = await api.listChannels();
        if (!items.length) {
          setState("empty", "No channels", "Create at least one channel from admin setup.");
          return;
        }
        setState("loading", "Route ready", "/admin/channels loaded.");
        setContent(
          "<h3>Channels</h3>" +
          "<table class='table'><thead><tr><th>ID</th><th>Type</th><th>Status</th><th>Updated</th></tr></thead><tbody>" +
          items.map(function (item) {
            return "<tr><td class='mono'>" + htmlEscape(item.id) + "</td>" +
              "<td>" + htmlEscape(item.type || "-") + "</td>" +
              "<td>" + htmlEscape(item.status || "-") + "</td>" +
              "<td>" + htmlEscape(item.updatedAt || "-") + "</td></tr>";
          }).join("") +
          "</tbody></table>"
        );
      }

      async function loadAutomations() {
        var list = await api.listAutomations({ page: 1, pageSize: 20 });
        var items = list.items || [];
        if (!items.length) {
          setState("empty", "No automation rules", "Create a trigger-action rule first.");
          return;
        }
        setState("loading", "Route ready", "/admin/automations loaded.");
        setContent(
          "<h3>Automations</h3>" +
          "<table class='table'><thead><tr><th>ID</th><th>Name</th><th>Type</th><th>Enabled</th></tr></thead><tbody>" +
          items.map(function (item) {
            return "<tr><td class='mono'>" + htmlEscape(item.id) + "</td>" +
              "<td>" + htmlEscape(item.name || "-") + "</td>" +
              "<td>" + htmlEscape(item.type || "-") + "</td>" +
              "<td>" + htmlEscape(String(Boolean(item.enabled))) + "</td></tr>";
          }).join("") +
          "</tbody></table>"
        );
      }

      async function loadIntegrations() {
        var items = await api.listIntegrations();
        integrationOptions = items;
        refreshDangerTargets();

        if (!items.length) {
          setState("empty", "No integrations", "Connect a commerce platform first.");
          return;
        }
        setState("loading", "Route ready", "/admin/integrations loaded.");
        setContent(
          "<h3>Integrations</h3>" +
          "<table class='table'><thead><tr><th>ID</th><th>Platform</th><th>Status</th><th>Synced</th></tr></thead><tbody>" +
          items.map(function (item) {
            return "<tr><td class='mono'>" + htmlEscape(item.id) + "</td>" +
              "<td>" + htmlEscape(item.platform || "-") + "</td>" +
              "<td>" + htmlEscape(item.status || "-") + "</td>" +
              "<td>" + htmlEscape(item.syncedAt || "-") + "</td></tr>";
          }).join("") +
          "</tbody></table>"
        );
      }

      async function loadAnalytics() {
        var data = await api.getAnalyticsSummary();
        if (!data) {
          setState("empty", "No analytics summary", "Generate message traffic first.");
          return;
        }
        setState("loading", "Route ready", "/admin/analytics loaded.");
        setContent(
          "<h3>Analytics summary</h3>" +
          "<table class='table'><tbody>" +
          "<tr><th>Total messages</th><td>" + htmlEscape(data.totalMessages) + "</td></tr>" +
          "<tr><th>Total customers</th><td>" + htmlEscape(data.totalCustomers) + "</td></tr>" +
          "<tr><th>Average response (ms)</th><td>" + htmlEscape(data.avgResponseMs) + "</td></tr>" +
          "<tr><th>Translation p95 (ms)</th><td>" + htmlEscape(data.translationP95Ms) + "</td></tr>" +
          "</tbody></table>"
        );
      }

      async function renderRoute() {
        updateSessionChips();
        var route = getCurrentRoute();
        updateActiveNav(route);
        var routeDef = routes[route];

        if (!auth.isLoggedIn()) {
          setState("error", "Unauthorized", "Login is required before accessing " + route);
          return;
        }
        if (!checkRoleAccess(route)) {
          var fallbackRoute = getFirstAllowedRoute();
          if (fallbackRoute && fallbackRoute !== route) {
            setState(
              "forbidden",
              "Forbidden",
              "Your role '" + (auth.getRole() || "unknown") + "' cannot access " + route + ". Redirecting to " + fallbackRoute + "."
            );
            setRoute(fallbackRoute);
            return;
          }
          setState(
            "forbidden",
            "Forbidden",
            "Your role '" + (auth.getRole() || "unknown") + "' cannot access " + route + "."
          );
          return;
        }

        setState("loading", "Loading", "Fetching data for " + route + " ...");
        try {
          await routeDef.loader();
        } catch (error) {
          if (error && error.status === 401) {
            auth.logout();
            updateSessionChips();
            setState("error", "Unauthorized", "Session is invalid. Login again.\n" + parseApiError(error));
            return;
          }
          if (error && error.status === 403) {
            setState("forbidden", "Forbidden", parseApiError(error));
            return;
          }
          setState("error", "Error", parseApiError(error));
        }
      }

      async function doLogin(username, password) {
        loginBtn.disabled = true;
        setState("loading", "Signing in", "Authenticating " + (username || "<empty>") + " ...");
        try {
          await auth.login(username, password);
          updateSessionChips();
          await renderRoute();
        } catch (error) {
          setState("error", "Login failed", parseApiError(error));
        } finally {
          loginBtn.disabled = false;
        }
      }

      async function runDangerRehearsal() {
        var role = auth.getRole();
        if (role !== "admin") {
          setState("forbidden", "Forbidden", "Destructive operations are blocked for role '" + role + "'.");
          return;
        }

        var reason = dangerReason.value.trim();
        if (reason.length < 8) {
          setState("error", "Validation failed", "Reason must be at least 8 characters.");
          return;
        }
        if (!dangerConfirm.checked) {
          setState("error", "Confirmation required", "Check the confirmation box before running.");
          return;
        }

        var target = dangerTarget.value || "none";
        var ask = window.confirm(
          "Confirm destructive rehearsal?\nTarget: " + target + "\nReason: " + reason + "\n\nA temporary channel will be created and deleted."
        );
        if (!ask) return;

        setState("loading", "Running", "Executing admin destructive rehearsal...");
        try {
          var created = await api.createChannel({
            type: "rehearsal-delete",
            config: {
              target: target,
              reason: reason,
              requestedBy: (auth.getSession().user && auth.getSession().user.username) || "unknown",
            },
          });
          var tempId = created && created.id;
          if (!tempId) throw new Error("Failed to create temporary target");

          await api.deleteChannel(tempId);

          auditEntries.unshift({
            at: new Date().toISOString(),
            actor: (auth.getSession().user && auth.getSession().user.username) || "unknown",
            action: "destructive-rehearsal",
            target: target,
            reason: reason,
          });
          renderAuditList();
          setState("empty", "Action completed", "Destructive rehearsal completed and recorded in local audit list.");
          dangerReason.value = "";
          dangerConfirm.checked = false;
          await renderRoute();
        } catch (error) {
          if (error && error.status === 403) {
            setState("forbidden", "Forbidden", parseApiError(error));
            return;
          }
          setState("error", "Action failed", parseApiError(error));
        }
      }

      form.addEventListener("submit", function (event) {
        event.preventDefault();
        doLogin(usernameInput.value.trim(), passwordInput.value);
      });

      quickAdminBtn.addEventListener("click", function () {
        usernameInput.value = "admin.demo";
        passwordInput.value = "pass-1234";
        doLogin(usernameInput.value, passwordInput.value);
      });

      quickAgentBtn.addEventListener("click", function () {
        usernameInput.value = "agent.demo";
        passwordInput.value = "pass-1234";
        doLogin(usernameInput.value, passwordInput.value);
      });

      logoutBtn.addEventListener("click", function () {
        auth.logout();
        updateSessionChips();
        renderRoute();
      });

      navButtons.forEach(function (button) {
        button.addEventListener("click", function () {
          if (button.disabled) return;
          setRoute(button.getAttribute("data-route"));
        });
      });

      gotoWorkbenchBtn.addEventListener("click", function () {
        window.location.href = "/apps/workbench/";
      });

      dangerRun.addEventListener("click", function () {
        runDangerRehearsal();
      });

      window.addEventListener("hashchange", function () {
        renderRoute();
      });

      renderAuditList();
      refreshDangerTargets();
      checkHealth();
      updateSessionChips();

      if (!location.hash) {
        setRoute("/admin/channels");
      } else {
        renderRoute();
      }
    }

    (function bootstrapAdmin() {
      function startAdmin() {
        if (!window.CBSPAuth || !window.CBSPApiClient || typeof window.CBSPApiClient.create !== "function") {
          var stateEl = document.getElementById("view-state");
          if (stateEl) {
            stateEl.className = "state error";
            stateEl.innerHTML =
              "<h3>error</h3><p><strong>Client bootstrap failed</strong>\nAuth/API client not loaded. Refresh this page or restart preview server.</p>";
          }
          return;
        }
        runAdmin(window.CBSPAuth, window.CBSPApiClient.create(window.CBSPAuth));
      }

      if (window.CBSPAuth && window.CBSPApiClient && typeof window.CBSPApiClient.create === "function") {
        startAdmin();
        return;
      }

      var fallbackScripts = [];
      if (!window.CBSPAuth) fallbackScripts.push("/apps/shared/auth-client.js?v=20260224");
      if (!window.CBSPApiClient) fallbackScripts.push("/apps/shared/api-client.js?v=20260224");

      if (!fallbackScripts.length) {
        startAdmin();
        return;
      }

      var remain = fallbackScripts.length;
      function done() {
        remain -= 1;
        if (remain <= 0) startAdmin();
      }
      fallbackScripts.forEach(function (src) {
        var fallback = document.createElement("script");
        fallback.src = src;
        fallback.onload = done;
        fallback.onerror = done;
        document.head.appendChild(fallback);
      });
    })();
  </script>
</body>
</html>
